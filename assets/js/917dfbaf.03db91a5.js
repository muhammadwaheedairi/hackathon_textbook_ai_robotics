"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[345],{829:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>p,frontMatter:()=>t,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"module-1-robotic-nervous-system/week-2-ros-2-fundamentals/chapter-4-services-packages","title":"ROS 2 Services and Packages","description":"Overview","source":"@site/docs/module-1-robotic-nervous-system/week-2-ros-2-fundamentals/chapter-4-services-packages.md","sourceDirName":"module-1-robotic-nervous-system/week-2-ros-2-fundamentals","slug":"/module-1-robotic-nervous-system/week-2-ros-2-fundamentals/chapter-4-services-packages","permalink":"/hackathon_textbook_ai_robotics/docs/module-1-robotic-nervous-system/week-2-ros-2-fundamentals/chapter-4-services-packages","draft":false,"unlisted":false,"editUrl":"https://github.com/muhammadwaheedairi/hackathon_textbook_ai_robotics/edit/main/my-website/docs/module-1-robotic-nervous-system/week-2-ros-2-fundamentals/chapter-4-services-packages.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"ROS 2 Services and Packages","sidebar_label":"Chapter 4: Services & Packages","sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Chapter 3: Nodes & Topics","permalink":"/hackathon_textbook_ai_robotics/docs/module-1-robotic-nervous-system/week-2-ros-2-fundamentals/chapter-3-nodes-topics"},"next":{"title":"Chapter 5: Python Agent Integration","permalink":"/hackathon_textbook_ai_robotics/docs/module-1-robotic-nervous-system/week-3-python-agent-integration/chapter-5-python-agent-integration"}}');var r=s(4848),a=s(8453);const t={title:"ROS 2 Services and Packages",sidebar_label:"Chapter 4: Services & Packages",sidebar_position:4},c="Chapter 4: ROS 2 Services and Packages",o={},l=[{value:"Overview",id:"overview",level:2},{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"ROS 2 Services",id:"ros-2-services",level:2},{value:"Service Characteristics",id:"service-characteristics",level:3},{value:"Service Architecture",id:"service-architecture",level:3},{value:"Service Implementation in Python",id:"service-implementation-in-python",level:3},{value:"Service Definition Files (.srv)",id:"service-definition-files-srv",level:3},{value:"Service Management Commands",id:"service-management-commands",level:3},{value:"When to Use Services vs Topics",id:"when-to-use-services-vs-topics",level:3},{value:"ROS 2 Packages",id:"ros-2-packages",level:2},{value:"Package Structure",id:"package-structure",level:3},{value:"Package Metadata (package.xml)",id:"package-metadata-packagexml",level:3},{value:"Creating Packages",id:"creating-packages",level:3},{value:"Python Package Setup (setup.py)",id:"python-package-setup-setuppy",level:3},{value:"Package Management Tools",id:"package-management-tools",level:3},{value:"Package Dependencies",id:"package-dependencies",level:3},{value:"Best Practices for Package Organization",id:"best-practices-for-package-organization",level:3},{value:"Code Examples",id:"code-examples",level:2},{value:"Service Server Example",id:"service-server-example",level:3},{value:"Service Client Example",id:"service-client-example",level:3},{value:"Summary",id:"summary",level:2},{value:"Key Takeaways",id:"key-takeaways",level:2},{value:"What&#39;s Next",id:"whats-next",level:2}];function d(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"chapter-4-ros-2-services-and-packages",children:"Chapter 4: ROS 2 Services and Packages"})}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"This chapter explores ROS 2 services for synchronous communication and packages for code organization. You'll learn how to implement request-response patterns and structure your robotics projects effectively."}),"\n",(0,r.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,r.jsxs)(n.admonition,{title:"Learning Objectives",type:"info",children:[(0,r.jsx)(n.p,{children:"By the end of this chapter, you will be able to:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Implement service servers and clients for synchronous communication"}),"\n",(0,r.jsx)(n.li,{children:"Understand when to use services versus topics"}),"\n",(0,r.jsx)(n.li,{children:"Create and organize ROS 2 packages"}),"\n",(0,r.jsx)(n.li,{children:"Manage package dependencies and build configurations"}),"\n"]})]}),"\n",(0,r.jsx)(n.h2,{id:"ros-2-services",children:"ROS 2 Services"}),"\n",(0,r.jsx)(n.p,{children:"Services provide synchronous request/response communication between nodes. A service client sends a request to a service server, which processes the request and returns a response. Services are ideal for operations that have a clear beginning and end, such as configuration changes, computation tasks, or triggering specific actions."}),"\n",(0,r.jsx)(n.h3,{id:"service-characteristics",children:"Service Characteristics"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Synchronous"}),": Client waits for response before continuing"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Request/Response"}),": Defined request and response message types"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Direct communication"}),": Client communicates directly with server"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Blocking"}),": Service calls block until response is received"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"One-to-one"}),": Each request is handled by a single service server"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Stateless"}),": Each service call is independent of others"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Typed interfaces"}),": Service definitions specify request and response message types"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"service-architecture",children:"Service Architecture"}),"\n",(0,r.jsx)(n.p,{children:"The service pattern works as follows:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"A service server node creates a service server and registers it with a service name"}),"\n",(0,r.jsx)(n.li,{children:"A service client node creates a service client and connects to the same service name"}),"\n",(0,r.jsx)(n.li,{children:"The client sends a request to the server"}),"\n",(0,r.jsx)(n.li,{children:"The server processes the request and sends back a response"}),"\n",(0,r.jsx)(n.li,{children:"The client receives the response and continues execution"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"service-implementation-in-python",children:"Service Implementation in Python"}),"\n",(0,r.jsx)(n.p,{children:"Here's how to implement service servers and clients in Python:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\nclass ServiceServerNode(Node):\n    def __init__(self):\n        super().__init__('service_server')\n        self.srv = self.create_service(\n            AddTwoInts,\n            'add_two_ints',\n            self.add_two_ints_callback\n        )\n        self.get_logger().info('Service server initialized')\n\n    def add_two_ints_callback(self, request, response):\n        response.sum = request.a + request.b\n        self.get_logger().info(f'Returning {request.a} + {request.b} = {response.sum}')\n        return response\n\nclass ServiceClientNode(Node):\n    def __init__(self):\n        super().__init__('service_client')\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\n\n        while not self.cli.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('Service not available, waiting again...')\n\n        self.req = AddTwoInts.Request()\n\n    def send_request(self, a, b):\n        self.req.a = a\n        self.req.b = b\n        self.future = self.cli.call_async(self.req)\n        return self.future\n"})}),"\n",(0,r.jsx)(n.h3,{id:"service-definition-files-srv",children:"Service Definition Files (.srv)"}),"\n",(0,r.jsxs)(n.p,{children:["Service definitions are specified in ",(0,r.jsx)(n.code,{children:".srv"})," files that define the request and response message structure:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# Request part (before the '---')\nint64 a\nint64 b\n---\n# Response part (after the '---')\nint64 sum\n"})}),"\n",(0,r.jsx)(n.h3,{id:"service-management-commands",children:"Service Management Commands"}),"\n",(0,r.jsx)(n.p,{children:"Common command-line tools for working with services:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# List all active services\nros2 service list\n\n# Show information about a specific service\nros2 service info /service_name\n\n# Call a service from command line\nros2 service call /add_two_ints example_interfaces/srv/AddTwoInts "{a: 1, b: 2}"\n\n# Show the type of a service\nros2 service type /service_name\n'})}),"\n",(0,r.jsx)(n.h3,{id:"when-to-use-services-vs-topics",children:"When to Use Services vs Topics"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Use Services when:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"You need request/response interaction"}),"\n",(0,r.jsx)(n.li,{children:"Operations have a clear beginning and end"}),"\n",(0,r.jsx)(n.li,{children:"You need guaranteed delivery and response"}),"\n",(0,r.jsx)(n.li,{children:"The operation is relatively fast (under a few seconds)"}),"\n",(0,r.jsx)(n.li,{children:"You need to pass parameters and get computed results"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Use Topics when:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"You need continuous data streaming"}),"\n",(0,r.jsx)(n.li,{children:"Communication should be decoupled in time"}),"\n",(0,r.jsx)(n.li,{children:"Multiple subscribers need the same data"}),"\n",(0,r.jsx)(n.li,{children:"Data is updated continuously (sensor data, status updates)"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"ros-2-packages",children:"ROS 2 Packages"}),"\n",(0,r.jsx)(n.p,{children:"Packages are the basic building and distribution units in ROS 2. They contain source code, data, and configuration files organized in a standard structure. Packages provide a way to organize related functionality, manage dependencies, and distribute ROS 2 software."}),"\n",(0,r.jsx)(n.h3,{id:"package-structure",children:"Package Structure"}),"\n",(0,r.jsx)(n.p,{children:"A standard ROS 2 package follows this structure:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"package_name/\n\u251c\u2500\u2500 CMakeLists.txt         # Build configuration for C++ packages\n\u251c\u2500\u2500 package.xml            # Package metadata and dependencies\n\u251c\u2500\u2500 src/                   # Source code files\n\u251c\u2500\u2500 include/               # Header files (C++)\n\u251c\u2500\u2500 launch/                # Launch files for starting multiple nodes\n\u251c\u2500\u2500 config/                # Configuration files\n\u251c\u2500\u2500 test/                  # Unit and integration tests\n\u251c\u2500\u2500 scripts/               # Standalone executable scripts\n\u251c\u2500\u2500 msg/                   # Custom message definitions\n\u251c\u2500\u2500 srv/                   # Custom service definitions\n\u251c\u2500\u2500 action/                # Custom action definitions\n\u2514\u2500\u2500 setup.py               # Python package setup (for Python packages)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"package-metadata-packagexml",children:"Package Metadata (package.xml)"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"package.xml"})," file contains metadata about the package and its dependencies:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0"?>\n<?xml-model href="http://download.ros.org/schema/package_format3.xsd" schematypens="http://www.w3.org/2001/XMLSchema"?>\n<package format="3">\n  <name>my_robot_package</name>\n  <version>0.1.0</version>\n  <description>A package for my robot functionality</description>\n  <maintainer email="user@example.com">User Name</maintainer>\n  <license>Apache-2.0</license>\n\n  <buildtool_depend>ament_cmake</buildtool_depend>\n\n  <depend>rclpy</depend>\n  <depend>std_msgs</depend>\n  <depend>sensor_msgs</depend>\n  <depend>geometry_msgs</depend>\n\n  <test_depend>ament_lint_auto</test_depend>\n  <test_depend>ament_lint_common</test_depend>\n\n  <export>\n    <build_type>ament_python</build_type>\n  </export>\n</package>\n'})}),"\n",(0,r.jsx)(n.h3,{id:"creating-packages",children:"Creating Packages"}),"\n",(0,r.jsxs)(n.p,{children:["Packages can be created using the ",(0,r.jsx)(n.code,{children:"ros2 pkg create"})," command:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Create a Python package\nros2 pkg create --build-type ament_python my_python_package\n\n# Create a C++ package\nros2 pkg create --build-type ament_cmake my_cpp_package\n\n# Create a package with dependencies\nros2 pkg create --build-type ament_python my_package \\\n  --dependencies rclpy std_msgs sensor_msgs geometry_msgs\n"})}),"\n",(0,r.jsx)(n.h3,{id:"python-package-setup-setuppy",children:"Python Package Setup (setup.py)"}),"\n",(0,r.jsxs)(n.p,{children:["For Python packages, the ",(0,r.jsx)(n.code,{children:"setup.py"})," file configures the Python build process:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from setuptools import setup\nimport os\nfrom glob import glob\n\npackage_name = 'my_robot_package'\n\nsetup(\n    name=package_name,\n    version='0.1.0',\n    packages=[package_name],\n    data_files=[\n        ('share/ament_index/resource_index/packages',\n            ['resource/' + package_name]),\n        ('share/' + package_name, ['package.xml']),\n        (os.path.join('share', package_name, 'launch'), glob('launch/*.py')),\n        (os.path.join('share', package_name, 'config'), glob('config/*.yaml')),\n    ],\n    install_requires=['setuptools'],\n    zip_safe=True,\n    maintainer='User Name',\n    maintainer_email='user@example.com',\n    description='A package for my robot functionality',\n    license='Apache-2.0',\n    tests_require=['pytest'],\n    entry_points={\n        'console_scripts': [\n            'my_node = my_robot_package.my_node:main',\n            'another_node = my_robot_package.another_node:main',\n        ],\n    },\n)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"package-management-tools",children:"Package Management Tools"}),"\n",(0,r.jsx)(n.p,{children:"ROS 2 provides several tools for managing packages:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"ros2 pkg"}),": Package management commands"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ros2 pkg list"}),": List all available packages"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ros2 pkg xml <package_name>"}),": Show package.xml content"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ros2 pkg executables <package_name>"}),": List executables in a package"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"colcon"}),": Build system for ROS 2 packages"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"colcon build"}),": Build all packages in the workspace"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"colcon build --packages-select <package_name>"}),": Build specific package"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"colcon test"}),": Run tests for packages"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"package-dependencies",children:"Package Dependencies"}),"\n",(0,r.jsx)(n.p,{children:"Dependencies in ROS 2 packages are categorized as:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"buildtool_depend"}),": Build system dependencies (e.g., ",(0,r.jsx)(n.code,{children:"ament_cmake"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"build_depend"}),": Dependencies needed during build time"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"exec_depend"}),": Dependencies needed at runtime"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"test_depend"}),": Dependencies needed for testing"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"depend"}),": Shorthand for both build and exec dependencies"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"best-practices-for-package-organization",children:"Best Practices for Package Organization"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Use descriptive package names that clearly indicate functionality"}),"\n",(0,r.jsx)(n.li,{children:"Follow the ROS 2 naming conventions (lowercase, underscores)"}),"\n",(0,r.jsx)(n.li,{children:"Keep related functionality together in the same package"}),"\n",(0,r.jsx)(n.li,{children:"Separate different types of functionality into different packages"}),"\n",(0,r.jsx)(n.li,{children:"Use appropriate dependency management"}),"\n",(0,r.jsx)(n.li,{children:"Include proper documentation and examples"}),"\n",(0,r.jsx)(n.li,{children:"Write comprehensive tests for your packages"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"code-examples",children:"Code Examples"}),"\n",(0,r.jsx)(n.h3,{id:"service-server-example",children:"Service Server Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\nclass ServiceServerNode(Node):\n    def __init__(self):\n        super().__init__('service_server_node')\n        self.srv = self.create_service(AddTwoInts, 'add_two_ints', self.add_two_ints_callback)\n        self.get_logger().info('Service Server Node initialized')\n\n    def add_two_ints_callback(self, request, response):\n        response.sum = request.a + request.b\n        self.get_logger().info(f'Returning {request.a} + {request.b} = {response.sum}')\n        return response\n\ndef main(args=None):\n    rclpy.init(args=args)\n    service_server_node = ServiceServerNode()\n\n    try:\n        rclpy.spin(service_server_node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        service_server_node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h3,{id:"service-client-example",children:"Service Client Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import sys\nimport rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\nclass ServiceClientNode(Node):\n    def __init__(self):\n        super().__init__('service_client_node')\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\n        while not self.cli.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('Service not available, waiting again...')\n        self.req = AddTwoInts.Request()\n        self.get_logger().info('Service Client Node initialized')\n\n    def send_request(self, a, b):\n        self.req.a = a\n        self.req.b = b\n        self.future = self.cli.call_async(self.req)\n        rclpy.spin_until_future_complete(self, self.future)\n        return self.future.result()\n\ndef main(args=None):\n    rclpy.init(args=args)\n    service_client_node = ServiceClientNode()\n\n    try:\n        a = int(sys.argv[1]) if len(sys.argv) > 1 else 1\n        b = int(sys.argv[2]) if len(sys.argv) > 2 else 2\n\n        response = service_client_node.send_request(a, b)\n        service_client_node.get_logger().info(f'Result of {a} + {b} = {response.sum}')\n    except Exception as e:\n        service_client_node.get_logger().error(f'Service call failed: {e}')\n    finally:\n        service_client_node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsx)(n.p,{children:"ROS 2 services provide synchronous request-response communication for operations with clear start and end points. Packages organize related code, dependencies, and resources into distributable units, enabling modular and maintainable robotics software development."}),"\n",(0,r.jsx)(n.h2,{id:"key-takeaways",children:"Key Takeaways"}),"\n",(0,r.jsx)(n.admonition,{title:"Key Takeaways",type:"tip",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Services enable synchronous request-response communication patterns"}),"\n",(0,r.jsx)(n.li,{children:"Use services for operations with clear beginning and end, topics for continuous data"}),"\n",(0,r.jsx)(n.li,{children:"Packages organize code into modular, distributable units"}),"\n",(0,r.jsx)(n.li,{children:"Proper dependency management ensures reliable package builds and deployments"}),"\n"]})}),"\n",(0,r.jsx)(n.h2,{id:"whats-next",children:"What's Next"}),"\n",(0,r.jsx)(n.p,{children:"In the next chapter, we'll explore Python agent integration with ROS 2 controllers, learning how to connect high-level AI decision-making with low-level robot control."})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>c});var i=s(6540);const r={},a=i.createContext(r);function t(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);